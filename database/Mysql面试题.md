#### Mysql面试题

##### 参考链接
1. https://juejin.im/post/5cb6c4ef51882532b70e6ff0
2. [MySQL面试高频一百问](https://juejin.im/post/5d351303f265da1bd30596f9?utm_source=gold_browser_extension#heading-2)
3. [匹配最左原则索引](https://segmentfault.com/a/1190000015416513)
4. [MySQL为什么需要一个主键](https://ruby-china.org/topics/26352)
5. [Hash碰撞和解决策略](https://www.kawabangga.com/posts/2493)

- MySQL主从复制的流程和原理


- MySQL中MyIsam和InnoDB的区别（至少5点）
1. InnoDB支持事务，MyISAM不支持
2. InnoDB支持行锁，MyISAM只支持表锁
3. InnoDB支持奔溃恢复，MyISAM不支持
4. InnoDB数据存储在共享表空间，MyISAM数据存储在文件中
5. InnoDB不支持全文索引，MyISAM支持全文索引


- InnoDB的4大特性
1. 插入缓冲
2. 二次写
3. 自适应哈希索引
4. 预读

- InnoDB和MyIsam两者select count() 谁快，为什么？
> MyIsam更快，因为内部维护了一个计数器，可以直接调取


- MySQL的数据类型
1. 整数类型（TINYINT,SMALLINT,MEDIUMINT,INT,BIGINT）
2. 实数类型(FLOAT,DOUBLE,DECIMAL)
3. 字符创类型(CHAR,VARCHAR,TEXT,BLOB)
4. 枚举类型(ENUM)
5. 日期和时间类型(TIMESTAMP,DATETIME)

- varchar和char的区别
1. varchar是变长，char是定长


- varchar(50)中的50涵义

- int(20)中的20的涵义

- 以上两个问题，为什么MySQL要这么设计？


- FLOAT和DOUBLE的区别
1. FLOAT类型可以储存至多8位十进制，并在内存中占4字节
2. DOUBLE类型数据可以存储至多18位十进制，并在内存中占8字节

- TINYINT,SMALLINT,MEDIUMINT,INT,BIGINT的区别？
1. TINYINT 占1个字节
2. SMALLINT 占2个字节
3. MEDIUMINT 占3个字节
4. INT 占4个字节
4. BIGINT 占8个字节


- Mysql有多少种日志
1. 二进制日志（binlog）

2. 错误日志

3. 查询日志

4. 慢查询日志

5. redolog（InnoDB的事务日志）

6. undolog（InnoDB的事务日志）



- Mysql的事务是如何实现的？
> 事务通过redolog和InnoDB的存储引擎日志缓冲实现的。巴拉巴拉...

- Mysql binlog的日志格式
保存操作数据的mysql语句


- MySQL的CPU飙升的处理（可能原因排查）
1. show processlist 查看进程，干掉

2. 查看超时日志和错误日志

> https://www.cnblogs.com/f-ck-need-u/archive/2018/05/08/9010872.html#auto_id_1

- 表中有大字段（文本类text），且字段不经常更新，以读为主，该如何处理？
1. 拆表，将改字段以及常用的相关查询主键拆分到新表，放置同一物理结构上顺序IO，减少连接消耗，文本列加上全文索引

>补充不拆表，会影响到查询性能，如果能接收是最好的选择

- 什么是索引？
> 简单来说，索引类似于书籍的目录结构，能不翻书就找到所需要的信息。索引是对数据表的一或多列的值进行排序的B+数，能帮助MySQL高效获取数据


- 索引是一个什么样的数据结构？
> 索引的数据结构和具体的存储引擎实现有关。在MySQL中使用较多的索引为HASH索引和B+数索引。InnoDB存储默认索引实现为B+树索引


- HASH索引的底层实现原理？
> HASH索引底层是HASH表，查找时，调用一次HASH函数可以获取相应的键值，之后进行回表查询获取实际数据。

- B+数索引的底层原理？
> B+树底层实现是多路平衡查找树，对于每次查询都从根节点触发，查找到的叶子节点获取所需键值，再根据查询判断是否需要回表查询数据。

- HASH索引和B+数索引的区别和优缺点？
1. HASH索引进行等值查询更快，但无法进行范围查询。因为HASH索引中经过HASH函数建立索引之后，索引的顺序无法和原顺序保持一致，不支持范围查询。B+数的所有节点均保持顺序（父节点>左节点 父节点<右节点）
2. HASH索引不支持使用索引进行排序
3. HASH索引不支持模糊查询及多列索引的最左前缀匹配。因为HASH函数的不可预测，AA和AB的索引没有相关性。
4. HASH索引任何时候都避免不了回表查询数据，B+树根据查询来确定是否需要回表
5. HASH索引比较不稳定，当摸个键值存在大量重复的时候会发生HASH碰撞，B+数查询效率比较稳定。

- 建立索引需要考虑什么因素？
1. 字段的使用频率，经常作为条件查询的字段比较适合
2. 建立联合索引，需要考虑索引的顺序呢
3. 尽量少创建索引。（因为创建和维护索引需要耗费空间和时间，当索引过多时会影响数据的维护效率）

- 什么时候不要添加索引？
1. 查询中很少用到的列；
2. 数据量很少的情况下；
3. 修改操作远大于查询操作，且对修改效率要求更高的情况下。


- 什么是联合索引？
> MySQL可以使用多个字段同时建立一个索引，称为联合索引。如果想要命中索引需要按照建立索引的字段的顺序使用，否则无法命中索引。
> 原因是：MySQL建立联合索引时是有序的。因此建立联合索引的时候应该注意索引列的顺序是否和查询需求吻合

- 为什么使用联合索引？
1. 减少开销。建立一个联合索引（a1,a2,a3），实际上相当于3个索引（a1）,(a1,a2),(a1,a2,a3)。建立索引是需要增加写操作和磁盘空间的开销。对于大量数据的表，建立联合索引会大大减少开销
2. 覆盖索引。当查询的字段都命中联合索引，则可以直接通过索引获得所需数据，无需进行回表操作，减少了很多的随机IO操作
3. 效率高。索引列越多，通过索引筛选出的数据越少，查询效率越高。

- 哪些情况下会发生针对该列创建了索引，但是查询的时候没有使用到
1. 使用不等于查询
2. 该列参与数学运算或者函数
3. 在字符串like时左边是通配符，类似于'%aaa'
4. 当MySQL分析全表扫描比使用索引快时
5. 当使用联合索引，前面一个条件为范围查询，后面的即使符合最左前缀原则，也无法使用索引

- 对于联合索引(a1,a2,a3)，查询语句：select * from test where a2=2; 是否触发索引？
> 答案：YES。 观察explain分析结果，只要命中索引或者联合索引的一部分，MySQL都会采用index类型的方式扫描。但是效率不高，MySQL会从索引中顺序查找直到找到符合天剑的数据。

- 索引对性能的影响？
1. 大大提高查询速度
2. 将随机IO变为顺序IO
3. 降低写的速度
4. 磁盘占用

- 什么是事务？
> 事务是指一系列操作，要么全部成功执行，要么都不执行。符合ACID特性。

- ACID？
1. 原子性，要么全部成功，要么全部失败；
2. 一致性
3. 隔离性，不同事务之间互不影响
4. 持久性，事务一旦提交，就会存入磁盘，永久保存。

多事务执行会造成的问题？
1. 脏读，A事务读到到B事务修改过但未提交的数据，而B事务后面进行了回滚。
2. 不可重复读，当设置了只能读取已提交的数据时，在事务A中两次相同查询得到的结果不一致，因为事务B在此期间进行了提交操作。（简单理解：相同事务同一条件下，两次读取的数据不能保证一致性，因此称为不可重复读。隔离级别可重复读就是为了解决不可重复读的问题）
3. 幻读，A事务两次读取了范围内容，事务B在此期间插入一条数据，造成事务A两次读取的条数不一致

- 脏读和不可重复读的区别？
> 脏读读到的是未提交事务的数据，不可重复读读到的是已提交事务的数据

- 不可重复读和幻读的区别？
> 不可重复读读到的同一行数据变了，幻读是读到同一范围间的数据条数变了


- 事务的隔离级别
1. 未提交读。指事务A可以读到事务B未提交的修改部分，该隔离级别会遇到脏读的情况
2. 已提交读。指事务A可以读到事务B已提交的修改部分，该隔离级别解决了脏读的问题，但会遇到不可重复读的问题
3. 可重复读。指事务A两次相同条件读取数据，得到的结果都是一致的。该隔离级别解决了不可重复读的问题，但会遇到幻读的问题
4. 可串行化。解决上面所有问题，强制将所有的操作串行执行，这会导致并发性能极低的问题。


- InnoDB默认隔离级别？
> 可重复读隔离级别

- 主键使用自增ID还是UUID好？
> 使用自增ID好。在InnoDB中，如果主键是自增ID，每次插入一条新的记录，会在当前聚簇索引顺序增加索引节点，如果是UUID作为主键，每次的值是随机的，因此插入记录时，要往聚簇索引添加索引节点，需要频繁移动，分页操作，查找索引节点位置，造成很多系统开销

- 什么是聚簇索引？
> 在B+树中，叶子节点存储了当前的key及整行的数据，即为聚簇索引。在InnoDB中，聚簇索引就是主键索引。

- 什么时候不需要进行回表查询？
1. 查询聚簇索引
2. 查询非聚簇索引，但是查询语句所要求的字段在该索引中都存在


- InnoDB如何保证事务？

- 使用索引一定能提高查询性能吗？

- drop ，delete，truncate的区别？

- 什么是数据库三范式

- 数据库的锁？

